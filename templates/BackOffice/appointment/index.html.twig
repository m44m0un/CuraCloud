{% extends 'Backoffice/base.html.twig' %}

{% block title %}Appointment Index{% endblock %}

{% block body %}
<div class="container mt-4">
    <div class="mb-3">
        <a href="{{ path('admin_app_appointment_new') }}" class="btn btn-primary"><i class="fas fa-plus-circle"></i> Create New Appointment</a>
    </div>
    <div class="table-responsive">
        <table class="table table-hover shadow-sm">
            <thead class="thead-dark">
                <tr>
                    <th>Id</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for appointment in appointments %}
                <tr>
                    <td>{{ appointment.id }}</td>
                    <td>{{ appointment.description }}</td>
                    <td>
                        <span class="badge rounded-pill" style="background-color: {{ appointment.status|lower == 'pending' ? '#ffc107' : (appointment.status|lower == 'confirmed' ? '#28a745' : '#dc3545') }}">{{ appointment.status }}</span>
                    </td>
                    <td>{{ appointment.startDate ? appointment.startDate|date('Y-m-d H:i:s') : 'N/A' }}</td>
                    <td>{{ appointment.endDate ? appointment.endDate|date('Y-m-d H:i:s') : 'N/A' }}</td>
                    <td class="text-center">
                        <a href="{{ path('admin_app_appointment_show', {'id': appointment.id}) }}" class="btn btn-outline-info btn-sm me-1"><i class="fas fa-eye"></i></a>
                        <a href="{{ path('admin_app_appointment_edit', {'id': appointment.id}) }}" class="btn btn-outline-warning btn-sm me-1"><i class="fas fa-edit"></i></a>
                        <button type="button" class="btn btn-outline-danger btn-sm" onclick="confirmDelete('{{ appointment.id }}')"><i class="fas fa-trash-alt"></i></button>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="6" class="text-center">No appointments found.</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function confirmDelete(appointmentId) {
    Swal.fire({
        title: 'Are you sure?',
        text: "You won't be able to revert this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = '{{ path('admin_app_appointment_delete', {'id': 'APPOINTMENT_ID'}) }}'.replace('APPOINTMENT_ID', appointmentId);
        }
    });
}
</script>
{% endblock %}
